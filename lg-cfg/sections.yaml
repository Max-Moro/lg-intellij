src:
  extensions: [".kt", ".kts", ".xml", ".properties"]
  filters:
    mode: allow
    allow:
      - "/gradle.properties"
      - "/build.gradle.kts"
      - "/settings.gradle.kts"
      - "/src/main/"
    when:
      - condition: "NOT TAGSET:intellij-plugin:send-to-ai"
        block: ["/src/main/kotlin/lg/intellij/ai/"]
    children:
      src/main:
        mode: allow
        allow:
          - "/kotlin/icons/"
          - "/resources/"
        children:
          resources:
            mode: allow
            allow:
              - "/messages/"
              - "/META-INF/"
            children:
              META-INF:
                mode: allow
                allow: ["/plugin.xml"]
                when:
                  - condition: "TAGSET:intellij-plugin:adaptive"
                    allow: ["/withGit.xml"]
                  - condition: "TAGSET:intellij-plugin:send-to-ai AND TAGSET:ai-providers:jetbrains-ai-assistant"
                    allow: ["/withJetBrainsAi.xml"]
                  - condition: "TAGSET:intellij-plugin:send-to-ai AND TAGSET:ai-providers:jetbrains-junie"
                    allow: ["/withJunie.xml"]
                  - condition: "TAGSET:intellij-plugin:send-to-ai AND TAGSET:ai-providers:github-copilot"
                    allow: ["/withGitHubCopilot.xml"]

      src/main/kotlin/lg/intellij:
        mode: allow
        when:
          # ==================== INFRASTRUCTURE ====================

          # Core - bundle, tool window, error reporting, settings
          - condition: "TAGSET:intellij-plugin:core"
            allow:
              - "/LgBundle.kt"
              - "/toolWindow/LgToolWindowFactory.kt"
              - "/services/LgErrorReportingService.kt"
              - "/services/state/LgSettingsService.kt"
              - "/settings/LgSettingsConfigurable.kt"

          # State Engine - universal coordination engine
          - condition: "TAGSET:intellij-plugin:state-engine"
            allow: ["/stateengine/"]

          # State PCE - LG-specific state management
          - condition: "TAGSET:intellij-plugin:state-pce"
            allow:
              - "/statepce/*.kt"
              - "/statepce/domains/index.kt"
              - "/statepce/domains/lifecycle.kt"
              - "/listeners/LgConfigFileListener.kt"
              - "/actions/LgClearStateAction.kt"

          # CLI Integration
          - condition: "TAGSET:intellij-plugin:cli"
            allow:
              - "/cli/"
              - "/listeners/LgSettingsChangeListener.kt"
              - "/services/LgInitService.kt"

          # UI Components
          - condition: "TAGSET:intellij-plugin:ui-components"
            allow: ["/ui/components/"]

          # ==================== BUSINESS DOMAINS ====================

          # Context Domain (state only)
          - condition: "TAGSET:intellij-plugin:context"
            allow:
              - "/statepce/domains/context.kt"
              - "/models/ContextsListSchema.kt"

          # Section Domain (state + included files tree)
          - condition: "TAGSET:intellij-plugin:section"
            allow:
              - "/statepce/domains/section.kt"
              - "/models/SectionsListSchema.kt"
              - "/ui/toolwindow/LgIncludedFilesPanel.kt"
              - "/ui/renderers/FileTreeCellRenderer.kt"
              - "/actions/LgShowIncludedFilesAction.kt"
              - "/actions/LgToggleTreeViewModeAction.kt"

          # Adaptive Domain - modes, tags, branches
          - condition: "TAGSET:intellij-plugin:adaptive"
            allow:
              - "/statepce/domains/adaptive.kt"
              - "/models/ModeSetsListSchema.kt"
              - "/models/TagSetsListSchema.kt"
              - "/ui/toolwindow/LgModeSetsPanel.kt"
              - "/ui/dialogs/LgTagsDialog.kt"
              - "/services/git/LgGitService.kt"
              - "/actions/LgConfigureTagsAction.kt"
              - "/ui/components/LgLabeledComponent.kt"

          # Stats Domain - statistics, tokenization
          - condition: "TAGSET:intellij-plugin:stats"
            allow:
              - "/statepce/domains/tokenization.kt"
              - "/services/generation/LgStatsService.kt"
              - "/services/generation/CliArgsBuilder.kt"
              - "/models/ReportSchema.kt"
              - "/models/EncodersListSchema.kt"
              - "/models/TokenizerLibsListSchema.kt"
              - "/ui/dialogs/LgStatsDialog.kt"
              - "/ui/components/LgGroupedTable.kt"
              - "/ui/components/LgEncoderCompletionField.kt"
              - "/actions/LgShowStatsAction.kt"
              - "/actions/LgShowContextStatsAction.kt"
              - "/actions/LgShowSectionStatsAction.kt"
              - "/utils/LgFormatUtils.kt"

          # Generate Domain - content generation
          - condition: "TAGSET:intellij-plugin:generate"
            allow:
              - "/services/generation/LgGenerationService.kt"
              - "/services/generation/CliArgsBuilder.kt"
              - "/services/vfs/LgVirtualFileService.kt"
              - "/actions/LgGenerateAction.kt"
              - "/actions/LgGenerateContextAction.kt"
              - "/actions/LgGenerateListingAction.kt"

          # Provider Domain - AI providers
          - condition: "TAGSET:intellij-plugin:send-to-ai"
            allow:
              - "/statepce/domains/provider.kt"
              - "/ai/"
              - "/models/ShellType.kt"
              - "/actions/LgSendToAiAction.kt"
              - "/actions/LgUpdateAiModesAction.kt"

          # Diagnostics Domain
          - condition: "TAGSET:intellij-plugin:diag"
            allow:
              - "/services/diagnostics/LgDiagnosticsService.kt"
              - "/ui/dialogs/LgDoctorDialog.kt"
              - "/actions/LgResetCacheAction.kt"
              - "/actions/LgRunDoctorAction.kt"
              - "/models/DiagReportSchema.kt"

          # Starter Domain
          - condition: "TAGSET:intellij-plugin:starter"
            allow:
              - "/ui/dialogs/LgInitWizardDialog.kt"
              - "/services/LgInitService.kt"
              - "/actions/LgCreateStarterConfigAction.kt"
              - "/actions/LgOpenConfigAction.kt"
              - "/models/InitResult.kt"

          # ==================== VIEWS ====================

          # Control Panel View
          - condition: "TAGSET:intellij-plugin:control"
            allow:
              - "/ui/toolwindow/LgControlPanel.kt"
              - "/services/state/LgWorkspaceStateService.kt"
              - "/ui/components/LgTaskTextField.kt"
              - "/ui/components/LgWrappingPanel.kt"
              - "/ui/components/LgLabeledComponent.kt"
              - "/actions/LgRefreshCatalogsAction.kt"

        children:
          ai:
            mode: block
            children:
              base:
                mode: allow
                when:
                  - condition: >
                      TAGSET:ai-providers:jetbrains-ai-assistant OR
                      TAGSET:ai-providers:jetbrains-junie OR
                      TAGSET:ai-providers:github-copilot
                    allow: ["/BaseExtensionProvider.kt"]
                  - condition: "TAGSET:ai-providers:claude-code-cli OR TAGSET:ai-providers:codex-cli"
                    allow: ["/BaseCliProvider.kt"]
              providers:
                mode: allow
                when:
                  - condition: "TAGSET:ai-providers:clipboard"
                    allow: ["/ClipboardProvider.kt"]
                  - condition: "TAGSET:ai-providers:jetbrains-ai-assistant"
                    allow: ["/JetBrainsAiProvider.kt"]
                  - condition: "TAGSET:ai-providers:jetbrains-junie"
                    allow: ["/JunieProvider.kt"]
                  - condition: "TAGSET:ai-providers:github-copilot"
                    allow: ["/GitHubCopilotProvider.kt"]
                  - condition: "TAGSET:ai-providers:claude-code-cli"
                    allow: ["/claudecli/"]
                  - condition: "TAGSET:ai-providers:codex-cli"
                    allow: ["/codexcli/"]

review:
  extensions: [".kt", ".kts", ".xml", ".properties"]
  filters:
    mode: allow
    allow:
      - "/gradle.properties"
      - "/build.gradle.kts"
      - "/settings.gradle.kts"
      - "/src/main/"
